<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Python Script Runner (Pyodide)</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
</head>
<body>
  <h1>Python Script Runner</h1>

  <form onsubmit="event.preventDefault(); runScript();">
    <label>Python script:
      <input type="file" id="scriptFile" accept=".py" required>
    </label>
    <br><br>
    <label>Input files:
      <input type="file" id="inputFiles" multiple>
    </label>
    <br><br>
    <label>Arguments:
      <input type="text" id="args" placeholder="example.txt output.txt">
    </label>
    <br><br>
    <button type="submit">Run</button>
  </form>

  <h2>Output</h2>
  <pre id="output" style="background:#f4f4f4; padding:10px; border-radius:5px;"></pre>

  <script>
    let pyodideReady = loadPyodide();

    async function runScript() {
      let pyodide = await pyodideReady;
      const scriptFile = document.getElementById("scriptFile").files[0];
      const inputFiles = document.getElementById("inputFiles").files;
      const args = document.getElementById("args").value.trim().split(/\s+/).filter(Boolean);
      const output = document.getElementById("output");

      if (!scriptFile) {
        output.textContent = "Please select a Python script.";
        return;
      }

      for (let f of inputFiles) {
        const data = new Uint8Array(await f.arrayBuffer());
        pyodide.FS.writeFile(f.name, data);
      }

      const code = await scriptFile.text();

      try {
        pyodide.runPython(`
import sys, io
from contextlib import redirect_stdout, redirect_stderr
_stdout = io.StringIO()
_stderr = io.StringIO()
`);
        pyodide.setSysArgv([scriptFile.name, ...args]);
        let result = await pyodide.runPythonAsync(`
with redirect_stdout(_stdout), redirect_stderr(_stderr):
    try:
        exec(${JSON.stringify(code)}, {})
    except Exception as e:
        import traceback
        traceback.print_exc()
_stdout.getvalue() + ("\\n--- STDERR ---\\n" + _stderr.getvalue() if _stderr.getvalue() else "")
        `);
        output.textContent = result;
      } catch (err) {
        output.textContent = "Error: " + err;
      }
    }
  </script>
</body>
</html>